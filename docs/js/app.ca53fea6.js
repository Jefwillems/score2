(function(t){function e(e){for(var o,a,c=e[0],r=e[1],l=e[2],p=0,h=[];p<c.length;p++)a=c[p],s[a]&&h.push(s[a][0]),s[a]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);d&&d(e);while(h.length)h.shift()();return n.push.apply(n,l||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],o=!0,c=1;c<i.length;c++){var r=i[c];0!==s[r]&&(o=!1)}o&&(n.splice(e--,1),t=a(a.s=i[0]))}return t}var o={},s={app:0},n=[];function a(e){if(o[e])return o[e].exports;var i=o[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=o,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(i,o,function(e){return t[e]}.bind(null,o));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var d=r;n.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"56d7":function(t,e,i){"use strict";i.r(e);var o=i("2b0e"),s=i("bb71");i("da64");o["a"].use(s["a"],{iconfont:"md"});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-app",[i("v-content",[i("Graph")],1)],1)},a=[],c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"explorerContainer"},[""!==t.topic?i("div",{attrs:{id:"topic"}},[i("h3",{staticClass:"text-xs-center"},[t._v("Current topic: "),i("span",[t._v(t._s(t.topic))])])]):t._e(),i("div",{ref:"graph",attrs:{id:"graph"}}),i("div",{attrs:{id:"btns"}},[i("v-btn",{attrs:{id:"reloadBtn",color:"warning"},on:{click:t.reload}},[t._v(t._s(t.btnText))]),i("v-btn",{attrs:{id:"demoBtn",color:"primary"},on:{click:t.enableDemo}},[t._v(t._s(t.demoBtnText))])],1),i("v-dialog",{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[i("v-card",{attrs:{color:"primary",dark:""}},[i("v-card-text",[t._v("\n        Please stand by\n        "),i("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1)],1)},r=[],l=i("2f62"),d={MUTATE_RAW_DATA:"mutate_raw_data",FETCH_SPREADSHEET_DATA:"fetch_spreadsheet",HANDLE_CLICK:"handle_click",RESET_BUTTON:"reset_button",SELECT_CITY:"select_city",SWAP_DEMO:"swap_demo_mode"},p=i("2ef0");const h={shape:"hexagon",mass:3,fixed:!1,font:{size:18}},u={...h,type:"city",color:"rgba(57,62,70,1)"},b={...h,type:"keywords",color:"rgba(0, 173, 181, 1)"},f={...h,type:"challenge",color:"rgba(248, 181, 0, 1)"},m={...h,type:"topics",color:"rgba(252, 60, 60, 1)"},_=[{...u,fixed:!0,physics:!1,size:25,x:25,y:0,label:"city"},{...b,fixed:!0,physics:!1,size:25,x:25,y:50,label:"keyword"},{...f,fixed:!0,physics:!1,size:25,x:25,y:100,label:"challenge"},{...m,fixed:!0,physics:!1,size:25,x:25,y:150,label:"topic"}];class g{constructor(t){this.data=t,this.title=t.title,this.description=t.description,this.topics=[],this.topics.push(...t.topics),this.keywords=[],this.keywords.push(...t.keywords)}get node(){return{label:this.title,...f}}get keywordNodes(){return Object(p["map"])(this.keywords,t=>({label:t,...b}))}}class y{constructor(t){this.name=t,this.challenges=[]}addChallenges(...t){this.challenges.push(...Object(p["map"])(t,t=>new g(t)))}get topics(){return Object(p["flatMap"])(this.challenges,t=>t.topics)}get topicNodes(){return Object(p["map"])(this.topics,t=>({label:t,...m}))}get node(){return{label:this.name,...u}}get challengeNodes(){return Object(p["map"])(this.challenges,t=>t.node)}get keywordNodes_all(){return Object(p["flatMap"])(this.challenges,t=>t.keywordNodes)}}var w=i("4f27");class O{constructor(t){const e=Object.keys(t);this.cities=Object(p["map"])(e,t=>new y(t)),Object(p["forEach"])(this.cities,e=>e.addChallenges(...t[e.name]))}find_city(t){return Object(p["find"])(this.cities,e=>e.name===t)}get_city_to_topic_view(){const t=[],e=[];let i=0;return Object(p["forEach"])(this.cities,o=>{const s={...o.node,id:++i};t.push(s);const n=Object(p["map"])(o.topicNodes,t=>({...t,id:++i}));Object(p["forEach"])(n,i=>{const o=t.find(t=>t.label===i.label);o?e.push({to:s.id,from:o.id}):(t.push({...i,id:i.id}),e.push({to:s.id,from:i.id}))})}),{nodes:new w["DataSet"](t),edges:new w["DataSet"](e)}}get_city_challenge_keyword_view(){const t=[];let e=0;Object(p["forEach"])(this.cities,i=>{const o={...i.node,id:++e};t.push(o);const s=Object(p["map"])(i.challengeNodes,t=>({...t,id:++e}));t.push(...s);const n=Object(p["map"])(i.keywordNodes_all,t=>({...t,id:++e}));Object(p["forEach"])(n,e=>Object(p["find"])(t,t=>t.label===e.label)?0:t.push(e))})}}const j=t=>{let e=0;return t.entry.map(t=>{const{gsx$city:{$t:i},gsx$contact:{$t:o},gsx$description:{$t:s},gsx$keywords:{$t:n},gsx$title:{$t:a},gsx$topics:{$t:c}}=t,r={city:i,contact:o,description:s,title:a,keywords:n.split(", ").filter(t=>""!==t),topics:c.split(", ").filter(t=>""!==t),id:++e,label:i};return r})},v=t=>{return Object(p["uniqBy"])(t,"city").map(t=>t.city).filter(t=>""!==t)},k=t=>e=>{return Object(p["union"])(...t.map(t=>t[e])).filter(t=>""!==t)};var T={mutate_raw_data(t,{feed:e}){const i=j(e),o=v(i),s=k(i),n=s("keywords"),a=s("topics"),c=Object(p["groupBy"])(Object(p["filter"])(i,t=>""!==t.city),"city");t.raw_data=c,t.cities=o.sort(),t.selected_cities=o.sort(),t.keywords=n,t.topics=a;const r=new O(c).get_city_to_topic_view();t.graph=r},handle_click(t,{nodes:e}){const i=t.graph.nodes.map(t=>t),o=Object(p["find"])(i,t=>t.id===e[0]&&"topics"===t.type);if(o){t.btnText="back",t.selected_topic={...o},t.topic=t.selected_topic.label;const e=Object(p["map"])(t.cities,t=>({label:t,...u})),i=Object(p["filter"])(Object(p["flatMap"])(e,e=>t.raw_data[e.label]),e=>Object(p["includes"])(e.topics,t.selected_topic.label)),s=Object(p["map"])(i,t=>({label:t.title,city:t.city,...f})),n=Object(p["map"])(Object(p["uniq"])(Object(p["flatMap"])(i,t=>t.keywords)),t=>({label:t,...b}));let a=0;const c=Object(p["map"])(Object(p["concat"])(s,e,n),t=>({...t,id:++a})),r=Object(p["map"])(Object(p["filter"])(c,t=>"challenge"===t.type),t=>({from:t.id,to:Object(p["find"])(c,e=>e.label===t.city).id})),l=Object(p["flatMap"])(Object(p["filter"])(c,t=>"challenge"===t.type),e=>{const{keywords:i}=Object(p["find"])(t.raw_data[e.city],t=>t.title===e.label);return Object(p["map"])(i,t=>({from:Object(p["find"])(c,e=>e.label===t).id,to:e.id}))}),d=Object(p["concat"])(r,l);t.graph={nodes:c,edges:d}}},reset_button(t){t.btnText="reload"},select_city({selected_cities:t},e){t=Object(p["find"])(t,e)?Object(p["filter"])(t,t=>t===e):[...t,e]},swap_demo_mode(t){t.demo=!t.demo}};const x=t=>fetch(t).then(t=>t.json());var E={fetch_spreadsheet({commit:t}){const e="https://spreadsheets.google.com/feeds/list/1adKrrgn-KxFe1mWHUXZEDvu23BIzHE2wLk2YfIQjzbM/1/public/values?alt=json";x(e).then(e=>{t(d.MUTATE_RAW_DATA,e),t(d.RESET_BUTTON)}).catch(t=>console.log(t))}},A={get_nodes_and_edges({graph:t}){return t},get_options:({options:t})=>t,btnText:({btnText:t})=>t,cities:({cities:t})=>t,selected_cities:({selected_cities:t})=>t,topic:({topic:t})=>t,demoBtnText:({demo:t})=>t?"Disable Demo":"Enable Demo"};o["a"].use(l["a"]);var D=new l["a"].Store({state:{topic:"",graph:{nodes:[],edges:[]},focus:"topics",cities:[],options:{autoResize:!0,height:"100%",width:"100%",layout:{improvedLayout:!0},physics:{}},raw_data:{},btnText:"Reload",demo:!1,selected_topic:{},selected_cities:[]},mutations:T,actions:E,getters:A});const S=_;var $={name:"Graph",props:{width:{type:String,default:function(){return"100%"}},height:{type:String,default:function(){return"100%"}}},data(){return{events:["doubleClick","selectNode","click"],network:null,dialog:!1,timeout:null}},computed:{...Object(l["c"])(["demo"]),...Object(l["b"])(["get_nodes_and_edges","get_options","btnText","topic","demoBtnText"])},watch:{get_nodes_and_edges:function(t){null!==this.network&&this.network.destroy();const e=this.$refs.graph,i=-e.clientWidth/2-50;let o=-e.clientHeight/2-50;const s=S.map(t=>{const{font:e}=t,s={...t,x:i,y:o,font:{...e,vadjust:-12}};return o+=80,s});t.nodes.add?t.nodes.add(s):t.nodes.push(...s),this.network=new w["Network"](e,t,this.get_options),this.events.forEach(t=>this.network.on(t,e=>this.handle_event(t,e))),this.network.on("afterDrawing",()=>this.dialog=!1),this.network.on("stabilizationIterationsDone",()=>{this.network.setOptions({physics:!1})})}},created(){},mounted(){this.dialog=!0,this.$store.state.topic="",this.$store.dispatch(d.FETCH_SPREADSHEET_DATA)},methods:{reload(){this.dialog=!0,this.demo&&(clearTimeout(this.timeout),this.$store.commit(d.SWAP_DEMO)),this.$store.state.topic="",this.$store.dispatch(d.FETCH_SPREADSHEET_DATA)},handle_event(t,e){switch(t){case"doubleClick":this.dialog=!0,this.$store.commit(d.HANDLE_CLICK,e),this.demo&&(clearTimeout(this.timeout),this.$store.commit(d.SWAP_DEMO));break;case"selectNode":this.demo&&(clearTimeout(this.timeout),this.$store.commit(d.SWAP_DEMO)),this.network.focus(e.nodes[0],{animation:{duration:800,easingFunction:"easeInCubic"},scale:1.2}),console.log(this.network);break;case"click":0!==e.nodes.length||0!==e.edges.length||this.demo||this.network.fit({animation:{duration:800,easingFunction:"easeInCubic"},scale:1.2});break;default:return}},enableDemo(){if(this.demo)clearTimeout(this.timeout);else{const t=20,e=()=>{const t=this.randomSecs(4,8),i=Object(p["sample"])(this.network.body.data.nodes.map(t=>t));this.network.focus(i.id,{animation:{duration:t,easingFunction:"easeOutCubic"},scale:1.1}),this.timeout=setTimeout(e,t+50)};this.timeout=setTimeout(e,t)}this.$store.commit(d.SWAP_DEMO)},randomSecs(t,e){return Math.floor(Math.random()*(1e3*e-1e3*t))+1e3*t}}},C=$,M=(i("8e60"),i("2877")),P=i("6544"),N=i.n(P),B=i("8336"),H=i("b0af"),z=i("99d9"),R=i("169a"),W=i("8e36"),I=Object(M["a"])(C,c,r,!1,null,null,null);I.options.__file="Graph.vue";var L=I.exports;N()(I,{VBtn:B["a"],VCard:H["a"],VCardText:z["a"],VDialog:R["a"],VProgressLinear:W["a"]});var F={name:"App",components:{Graph:L},data(){return{}}},V=F,U=i("7496"),G=i("549c"),K=Object(M["a"])(V,n,a,!1,null,null,null);K.options.__file="App.vue";var q=K.exports;N()(K,{VApp:U["a"],VContent:G["a"]}),o["a"].config.productionTip=!1,new o["a"]({store:D,render:t=>t(q)}).$mount("#app")},"8e60":function(t,e,i){"use strict";var o=i("af4a"),s=i.n(o);s.a},af4a:function(t,e,i){}});
//# sourceMappingURL=app.ca53fea6.js.map